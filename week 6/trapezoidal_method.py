# 2.2 Trapezoidal Rule (Numerical Integration)
# ∫f(x)dx ≈ (h/2)[f(x_0) + 2f(x_1) + 2f(x_2) + ... + 2f(x_{n-1}) + f(x_n)]
#
# ОПИСАНИЕ:
# Правило трапеций — простейший метод численного интегрирования. Криволинейная
# область под графиком f(x) заменяется набором трапеций: между каждой парой
# соседних точек (x_i, y_i) и (x_{i+1}, y_{i+1}) строится трапеция, и её площадь
# суммируется. Площадь одной трапеции = (h/2)(y_i + y_{i+1}).
#
# Требования: равномерная сетка (одинаковый шаг h между узлами).
# Погрешность: O(h²) на интервал, т.е. метод первого порядка точности.
# Коэффициенты: концевые точки — 1, внутренние — 2.


# --- ФУНКЦИЯ ВЫЧИСЛЕНИЯ ИНТЕГРАЛА ---
def trapezoidal_rule(x_nodes, y_nodes):
    """Trapezoidal rule: ∫f ≈ (h/2)[y_0 + 2*y_1 + ... + 2*y_{n-1} + y_n]"""
    # Шаг h — расстояние между соседними узлами (равномерная сетка)
    n = len(y_nodes)
    h = x_nodes[1] - x_nodes[0]

    # Сумма: (y_0 + y_n)/2 + y_1 + y_2 + ... + y_{n-1}
    # Концы входят с весом 1/2, внутренние — с весом 1
    result = (y_nodes[0] + y_nodes[-1]) / 2
    for i in range(1, n - 1):
        result += y_nodes[i]

    # Итоговый интеграл = h * сумма
    return h * result


# Демонстрация работы метода (запускается при прямом вызове файла)
if __name__ == "__main__":
    # Тестовые данные: y = x² + 1, ∫(x²+1)dx от 1 до 4 = 24
    x_eq = [1.0, 2.0, 3.0, 4.0]
    y_eq = [2.0, 4.0, 7.0, 11.0]

    # Вывод заголовка и входных данных
    print("--- 2.2 Trapezoidal Rule ---")
    print(f"Data: x = {x_eq}, y = {y_eq}")
    print(f"h = {x_eq[1] - x_eq[0]}")

    # Вычисление интеграла и вывод результата
    result = trapezoidal_rule(x_eq, y_eq)
    print(f"∫f dx ≈ {result:.6f}")
    print("True value (x³/3 + x | 1→4): 24.0")
